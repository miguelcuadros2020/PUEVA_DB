<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejemplo - Formulario de Edici√≥n</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .container { max-width: 800px; }
        .card { margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .btn-group { margin-top: 20px; }
        .hidden { display: none; }
        .demo-data { background-color: #e9ecef; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Datos de ejemplo -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h4>üìã Datos de Ejemplo para Probar</h4>
            </div>
            <div class="card-body">
                <div class="demo-data">
                    <h6>IDs disponibles para probar:</h6>
                    <ul>
                        <li><strong>ID 1:</strong> Usuario b√°sico</li>
                        <li><strong>ID 2:</strong> Usuario con m√°s campos</li>
                        <li><strong>ID 3:</strong> Producto</li>
                    </ul>
                    <p class="mb-0"><small>Este es un ejemplo simulado. En tu proyecto real, estos datos vendr√≠an de tu backend.</small></p>
                </div>
            </div>
        </div>

        <!-- Formulario de b√∫squeda -->
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4>üîç Buscar Registro</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">ID del Registro:</label>
                            <input type="text" class="form-control" id="searchId" placeholder="Ingresa el ID (1, 2 o 3)">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">&nbsp;</label>
                            <button class="btn btn-primary w-100" onclick="buscarRegistro()">
                                üîç Buscar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Formulario de edici√≥n -->
        <div class="card hidden" id="formularioEdicion">
            <div class="card-header bg-success text-white">
                <h4>‚úèÔ∏è Editar Registro</h4>
            </div>
            <div class="card-body">
                <div id="camposDinamicos">
                    <!-- Los campos se generan din√°micamente aqu√≠ -->
                </div>
                
                <div class="btn-group w-100">
                    <button class="btn btn-success" onclick="guardarCambios()">
                        üíæ Guardar Cambios
                    </button>
                    <button class="btn btn-secondary" onclick="cancelarEdicion()">
                        ‚ùå Cancelar
                    </button>
                </div>
            </div>
        </div>

        <!-- Mensajes -->
        <div id="mensajes"></div>

        <!-- Datos JSON que se enviar√≠an -->
        <div class="card hidden" id="jsonPreview">
            <div class="card-header bg-warning text-dark">
                <h5>üì§ JSON que se enviar√≠a a tu backend:</h5>
            </div>
            <div class="card-body">
                <pre id="jsonContent" class="bg-light p-3 rounded"></pre>
            </div>
        </div>
    </div>

    <script>
        let registroActual = null;
        let camposOriginales = null;

        // Datos de ejemplo (simula tu backend)
        const datosEjemplo = {
            1: {
                id: 1,
                nombre: "Juan P√©rez",
                email: "juan@email.com",
                edad: 25,
                activo: true,
                fecha_registro: "2024-01-15"
            },
            2: {
                id: 2,
                nombre: "Ana Garc√≠a",
                email: "ana@email.com",
                edad: 30,
                activo: false,
                departamento: "Ventas",
                salario: 45000,
                telefono: "+1234567890",
                notas: "Empleada destacada con excelente rendimiento en ventas del √∫ltimo trimestre"
            },
            3: {
                id: 3,
                codigo: "P001",
                nombre: "Laptop Gaming",
                precio: 1299.99,
                categoria: "Electr√≥nicos",
                stock: 15,
                disponible: true,
                descripcion: "Laptop de alto rendimiento para gaming y trabajo profesional"
            }
        };

        // Funci√≥n para buscar registro por ID (simulada)
        async function buscarRegistro() {
            const id = document.getElementById('searchId').value.trim();
            
            if (!id) {
                mostrarMensaje('Por favor ingresa un ID', 'warning');
                return;
            }

            // Simular delay de red
            mostrarMensaje('Buscando registro...', 'info');
            
            setTimeout(() => {
                if (datosEjemplo[id]) {
                    registroActual = datosEjemplo[id];
                    camposOriginales = JSON.parse(JSON.stringify(registroActual));
                    mostrarFormularioEdicion();
                    mostrarMensaje('Registro encontrado', 'success');
                } else {
                    mostrarMensaje('No se encontr√≥ el registro con ID ' + id, 'warning');
                }
            }, 1000);
        }

        // Funci√≥n para mostrar el formulario de edici√≥n
        function mostrarFormularioEdicion() {
            const formulario = document.getElementById('formularioEdicion');
            const camposDiv = document.getElementById('camposDinamicos');
            
            // Limpiar campos anteriores
            camposDiv.innerHTML = '';
            
            // Generar campos din√°micamente
            Object.keys(registroActual).forEach(key => {
                if (key !== 'id') { // No mostrar el campo ID para editar
                    const campo = crearCampo(key, registroActual[key]);
                    camposDiv.appendChild(campo);
                }
            });
            
            formulario.classList.remove('hidden');
            actualizarPreviewJSON();
        }

        // Funci√≥n para crear un campo de formulario
        function crearCampo(nombre, valor) {
            const div = document.createElement('div');
            div.className = 'form-group';
            
            let inputHtml = '';
            const tipo = determinarTipoCampo(valor);
            
            if (tipo === 'textarea') {
                inputHtml = `<textarea class="form-control" id="campo_${nombre}" rows="3" onchange="actualizarPreviewJSON()">${valor || ''}</textarea>`;
            } else if (tipo === 'select') {
                inputHtml = `<select class="form-control" id="campo_${nombre}" onchange="actualizarPreviewJSON()">${generarOpcionesSelect(nombre, valor)}</select>`;
            } else if (tipo === 'checkbox') {
                inputHtml = `<input type="checkbox" class="form-check-input" id="campo_${nombre}" ${valor ? 'checked' : ''} onchange="actualizarPreviewJSON()">`;
            } else {
                inputHtml = `<input type="${tipo}" class="form-control" id="campo_${nombre}" value="${valor || ''}" onchange="actualizarPreviewJSON()">`;
            }
            
            div.innerHTML = `
                <label class="form-label">${formatearNombreCampo(nombre)}:</label>
                ${inputHtml}
            `;
            
            return div;
        }

        // Funci√≥n para determinar el tipo de campo
        function determinarTipoCampo(valor) {
            if (typeof valor === 'boolean') return 'checkbox';
            if (typeof valor === 'number') return 'number';
            if (typeof valor === 'string') {
                if (valor.includes('@') && valor.includes('.')) return 'email';
                if (valor.startsWith('http')) return 'url';
                if (valor.length > 100) return 'textarea';
                return 'text';
            }
            return 'text';
        }

        // Funci√≥n para generar opciones de select
        function generarOpcionesSelect(nombre, valorActual) {
            const opciones = {
                'categoria': ['Electr√≥nicos', 'Ropa', 'Hogar', 'Deportes'],
                'departamento': ['Ventas', 'IT', 'Marketing', 'Recursos Humanos']
            };
            
            if (opciones[nombre]) {
                return opciones[nombre].map(opcion => 
                    `<option value="${opcion}" ${opcion === valorActual ? 'selected' : ''}>${opcion}</option>`
                ).join('');
            }
            
            return `<option value="${valorActual}">${valorActual}</option>`;
        }

        // Funci√≥n para formatear nombres de campos
        function formatearNombreCampo(nombre) {
            return nombre
                .replace(/_/g, ' ')
                .replace(/\b\w/g, char => char.toUpperCase());
        }

        // Funci√≥n para actualizar preview del JSON
        function actualizarPreviewJSON() {
            if (!registroActual) return;
            
            const datosActualizados = { ...registroActual };
            
            Object.keys(registroActual).forEach(key => {
                if (key !== 'id') {
                    const elemento = document.getElementById(`campo_${key}`);
                    if (elemento) {
                        if (elemento.type === 'checkbox') {
                            datosActualizados[key] = elemento.checked;
                        } else {
                            datosActualizados[key] = elemento.value;
                        }
                    }
                }
            });
            
            const jsonPreview = document.getElementById('jsonPreview');
            const jsonContent = document.getElementById('jsonContent');
            
            jsonContent.textContent = JSON.stringify(datosActualizados, null, 2);
            jsonPreview.classList.remove('hidden');
        }

        // Funci√≥n para guardar cambios (simulada)
        async function guardarCambios() {
            try {
                // Recopilar datos del formulario
                const datosActualizados = { ...registroActual };
                
                Object.keys(registroActual).forEach(key => {
                    if (key !== 'id') {
                        const elemento = document.getElementById(`campo_${key}`);
                        if (elemento) {
                            if (elemento.type === 'checkbox') {
                                datosActualizados[key] = elemento.checked;
                            } else {
                                datosActualizados[key] = elemento.value;
                            }
                        }
                    }
                });
                
                // Verificar si hay cambios
                if (JSON.stringify(datosActualizados) === JSON.stringify(camposOriginales)) {
                    mostrarMensaje('No hay cambios para guardar', 'info');
                    return;
                }
                
                mostrarMensaje('Guardando cambios...', 'info');
                
                // Simular env√≠o a backend
                setTimeout(() => {
                    // Aqu√≠ en tu proyecto real usar√≠as:
                    // const response = await axios.put(`/api/registros/${registroActual.id}`, datosActualizados);
                    
                    mostrarMensaje('‚úÖ Cambios guardados exitosamente (simulado)', 'success');
                    registroActual = datosActualizados;
                    camposOriginales = JSON.parse(JSON.stringify(registroActual));
                    
                    // Actualizar datos de ejemplo
                    datosEjemplo[registroActual.id] = datosActualizados;
                    
                }, 1500);
                
            } catch (error) {
                console.error('Error al guardar:', error);
                mostrarMensaje('Error al guardar los cambios', 'danger');
            }
        }

        // Funci√≥n para cancelar edici√≥n
        function cancelarEdicion() {
            document.getElementById('formularioEdicion').classList.add('hidden');
            document.getElementById('jsonPreview').classList.add('hidden');
            document.getElementById('searchId').value = '';
            registroActual = null;
            camposOriginales = null;
            mostrarMensaje('Edici√≥n cancelada', 'info');
        }

        // Funci√≥n para mostrar mensajes
        function mostrarMensaje(texto, tipo) {
            const mensajesDiv = document.getElementById('mensajes');
            const alerta = document.createElement('div');
            alerta.className = `alert alert-${tipo} alert-dismissible fade show`;
            alerta.innerHTML = `
                ${texto}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            mensajesDiv.innerHTML = '';
            mensajesDiv.appendChild(alerta);
            
            // Auto-ocultar despu√©s de 5 segundos
            setTimeout(() => {
                if (alerta.parentNode) {
                    alerta.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>
